{{>header}}



<link rel="stylesheet" href="/css/main1.css">
<div id="back_ground">
    <div style="width: 100%;max-width: 1300px; height: auto; margin: 0 auto;">
        <div class="popup" id="popup">
            <div style="background-color:#576096; width: 100%; height: 10%; color: white; font-family: Hakgyo; font-size: 25px; display: flex; align-items: center; padding: 10px;">
                ìˆ˜ì—… ì¶”ê°€
            </div>
            <div style="display: flex; justify-content: center; width: 100%; padding-bottom: 60px;">
                <form id="classForm" method="POST" action="/teacher/classDelete" style="padding: 10px; width: 80%; font-family: Score5; font-size: 20px">

                    <!-- ìˆ˜ì—… ì½”ë“œ ì…ë ¥ í•„ë“œ -->
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="text" id="classCodeInput" placeholder="ìˆ˜ì—… ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                               style="width: 100%; padding: 8px; font-size: 16px; border: 1px solid #ccc; border-radius: 5px;">
                        <button type="button" onclick="searchClass()" class="btnSearch">
                            ê²€ìƒ‰
                        </button>
                    </div>

                    <!-- ê²€ìƒ‰ëœ ìˆ˜ì—… ì •ë³´ í‘œì‹œ -->
                    <div id="classInfo" style="display: none; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px;">
                        <p id="classDetails" style="margin: 0; font-size: 18px; font-weight: bold;"></p>
                        <button type="button" onclick="addToCart({{member.id}})" style="margin-top: 5px; padding: 5px 10px; background: #2ecc71; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°
                        </button>
                    </div>

                    <!-- ì¥ë°”êµ¬ë‹ˆ ë¦¬ìŠ¤íŠ¸ -->
                    <ul id="cartList"></ul>
                </form>
            </div>

            <!-- ë²„íŠ¼ ì˜ì—­ì„ í•˜ë‹¨ì— ê³ ì • -->
            <div style="position: absolute; bottom: 0; width: 100%; background: white; padding: 10px; display: flex; align-items: center; justify-content: flex-end; border-top: 1px solid #ddd;">
                <button type="button" id="deleteClosePopup" class="btnAll" onclick="popupClose()">ì·¨ì†Œ</button>
                <button type="button" class="btnAll" style="margin-left: 15px; background: #EB6319;" onclick="submitCart()">ì €ì¥í•˜ê¸°</button>
            </div>
        </div>

        <div style="display: flex; justify-content: flex-start; width: 100%; padding: 0; margin: 0;">
            <div id="text" class="title">ğŸ  Home</div>
        </div>
        <!-- í•™êµ ë° ì„ ìƒë‹˜ ì •ë³´ -->
        <div class="container">
            <div class="info-box">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0 0 10px 0;font-size: 1.3em;font-weight: bold; color: #576096;font-family: Hakgyo">í•™êµ & í•™ê¸‰ ì •ë³´</h2>
                    {{^isTeacher}}
                    <button onclick="confirmChange('{{member.id}}')"
                            style="background-color: #576096; color: white; border: none;font-family: Score4;
                            border-radius: 5px; cursor: pointer; display: flex; justify-content: center; align-items: center;
                            text-align: center; padding: 5px;font-size: 13px; margin-bottom: 5px;">
                        ì¬ì„¤ì •
                    </button>
                    {{/isTeacher}}
                </div>
                <div class="info-content" >
                    <p style="font-size: 1.2em; font-weight: bold; color: #333;">ğŸ« {{member.school}}</p>
                    <p style="font-size: 1.2em; font-weight: bold; color: #333;">ğŸªª{{member.schoolgrade}}í•™ë…„ {{member.schoolClass}}ë°˜</p>
                </div>
            </div>

            <div class="info-box">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0 0 10px 0;font-size: 1.3em;font-weight: bold; color: #576096;font-family: Hakgyo">ë‹´ì„ ì„ ìƒë‹˜ ì •ë³´</h2>
                </div>

                <div class="info-content">
                    <img class="profile"
                         id="profile_Image"
                         src=" {{teacherInfo.img_path}}"
                         onerror="this.src='/blank_profile/blank_profile.svg';" />
                    <div class="info" style="position: relative;left:4vw;">
                    <p style="font-size: 1.2em; font-family: Score6; color: #333; ">ì„±í•¨ : {{teacherInfo.name}}</p>
                    <p style="font-size: 1.2em;  font-family: Score6; color: #333; ">ì „í™”ë²ˆí˜¸ : 0{{teacherInfo.phoneNumber}}</p>
                    </div>

                </div>
            </div>
        </div>

        <!-- ê²Œì‹œíŒ -->
        <div class="grid">
            <!-- ìˆ˜ì—… ê²Œì‹œíŒ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0 0 10px 0;font-size: 1.3em;font-weight: bold; color: #576096;font-family: Hakgyo">ìˆ˜ê°• ëª©ë¡</h2>
                </div>
                <div class="scroll-container" id="scrollContainer">
                {{#subjects}}
                    <div class="scroll-card">
                        {{^isTeacher}}
                        <button class="delete-btn" onclick="deleteClass('{{id}}')">âœ•</button>
                        {{/isTeacher}}
                        <h4 style="font-family: Score8">{{subject}}</h4>
                        <p style="font-family: Score5">{{grade}}í•™ë…„ {{divClass}}ë¶„ë°˜</p>
                        <br>
                        <p style="font-family: Score5">ë‹´ë‹¹ ì„ ìƒë‹˜ : {{teacher.name}}</p>
                        <a style="font-size: 15px; font-family: Score4" href="/board/noticeList?id={{id}}">ê³¼ëª© ê²Œì‹œíŒìœ¼ë¡œ ì´ë™-></a>
                    </div>
                {{/subjects}}
                {{^subjects}}
                    <div class="scroll-card"><a href="#">ê³¼ëª© ë“±ë¡ì„ í•´ë³´ì„¸ìš”! </a></div>
                {{/subjects}}
                {{^isTeacher}}
                    <div class="scroll-card" onclick="popup()" style="cursor:pointer;"><h1>&#43</h1></div>
                {{/isTeacher}}
                </div>
            </div>

            <!-- ìš°ë¦¬ë°˜ ì†Œì‹ -->
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="text-align: left; margin: 0;">ìš°ë¦¬ë°˜ ì»¤ë®¤ë‹ˆí‹°</h2>
                    <button onclick="location.href='/myClass/list?id={{member.teacherCode}}'"
                    style="background-color: #576096; color: white; border: none;font-family: Score4;
                    border-radius: 5px; cursor: pointer; display: flex; justify-content: center; align-items: center;
                    text-align: center; padding: 5px;font-size: 13px;">
                    ëª©ë¡ ë³´ê¸°
                    </button>
                </div>
                <ul class="cardIn">
                    {{#classBoard}}
                        <li onclick="location.href='/myClass?id={{member.teacherCode}}&num={{id}}'" class="clickable">
                            <span class="title-text">{{title}}</span>
                            <span class="date-text">{{updated}}</span>
                        </li>
                    {{/classBoard}}
                    {{^classBoard}}
                        <li class="empty">
                            <span class="title-text">ìš°ë¦¬ë°˜ ì»¤ë®¤ë‹ˆí‹°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.</span>
                        </li>
                    {{/classBoard}}
                </ul>
            </div>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const scrollContainer = document.getElementById("scrollContainer");

        scrollContainer.addEventListener("wheel", function (event) {
            event.preventDefault();
            scrollContainer.scrollLeft += event.deltaY * 2; // ë§ˆìš°ìŠ¤ íœ  ì†ë„ ì¡°ì ˆ (2ë°° ë¹ ë¥´ê²Œ)
        });

        var fileName = "{{teacherInfo.img_path}}";

        fetch("/signed-url?fileName=" + encodeURIComponent(fileName))   //íŠ¹ìˆ˜ë¬¸ì ê°™ì€ê±° ì¸ì½”ë”©
                .then(response => response.text())
                .then(url => {
                    document.getElementById("profile_Image").src = url;
                })
                .catch(error => console.error("Error loading image:", error));


    });

    function popup(){
        document.getElementById('popup').style.display = 'block';
    }
    let cart = []; // ì¥ë°”êµ¬ë‹ˆ ë°°ì—´

    // ìˆ˜ì—… ê²€ìƒ‰ AJAX
    function searchClass() {
        const classCode = document.getElementById("classCodeInput").value.trim();
        if (!classCode) return;

        fetch(`/myClass/find?code=${classCode}`)
                .then(response => response.json())
                .then(data => {
                    if (data) {
                        document.getElementById("classDetails").innerHTML = `
                           <span style="font-weight: bold;">ìˆ˜ì—…ëª…: ${data.subject} (ì½”ë“œ: ${data.id})</span><br>
                           <span>${data.grade}í•™ë…„ ${data.divClass}ë¶„ë°˜ | êµì‚¬: ${data.teacherName}</span>`;

                        document.getElementById("classInfo").style.display = "block";
                        document.getElementById("classInfo").dataset.classId = data.id; // ìˆ¨ê²¨ì§„ ID ì €ì¥
                    }
                })
                .catch(error => console.error("Error:", error));
    }

    // ì¥ë°”êµ¬ë‹ˆ ì¶”ê°€
    function addToCart(memberId) {
        const classId = document.getElementById("classInfo").dataset.classId;
        const classDetails = document.getElementById("classDetails").textContent;

        // ì¤‘ë³µ í™•ì¸ (classIdê°€ ê°™ì€ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì¶”ê°€ X)
        if (!cart.some(item => item.classId === classId)) {
            cart.push({ classId, memberId });

            const listItem = document.createElement("li");
            listItem.style.display = "flex";
            listItem.style.justifyContent = "space-between";
            listItem.style.padding = "10px";
            listItem.style.borderBottom = "1px solid #ddd";

            listItem.innerHTML = `
            <span>${classDetails}</span>
            <button type="button" onclick="removeFromCart('${classId}', this)"
                style="background: red; color: white; border: none; padding: 3px 6px; cursor: pointer;
                border-radius: 15%; font-size: 12px; width: 20px; height: 20px;
                display: flex; align-items: center; justify-content: center;">
                âœ•
            </button>
        `;

            document.getElementById("cartList").appendChild(listItem);
            document.getElementById("cartList").style.display = "block";
        }
    }

    // ì¥ë°”êµ¬ë‹ˆ ì‚­ì œ
    function removeFromCart(classId, button) {
        cart = cart.filter(item => item.classId !== classId);
        button.parentElement.remove();

        if (cart.length === 0) {
            document.getElementById("cartList").style.display = "none";
        }
    }

    // ì¥ë°”êµ¬ë‹ˆ ì €ì¥
    function submitCart() {
        if (cart.length === 0) {
            alert("ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ìˆ˜ì—…ì´ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        fetch("/myClass/classSave", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(cart)
        })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        alert(data.message); // ì„œë²„ì—ì„œ ë°›ì€ ë©”ì‹œì§€ë¥¼ alertì— í‘œì‹œ
                    } else {
                        alert("ì‘ë‹µ ì˜¤ë¥˜: ì„œë²„ì—ì„œ ë©”ì‹œì§€ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                    }
                    location.reload();
                })
                .catch(error => console.error("Error:", error));
    }

    // íŒì—… ë‹«ê¸°
    function popupClose() {
        document.getElementById("popup").style.display = "none";
        document.getElementById("classCodeInput").value = "";
        document.getElementById("classInfo").style.display = "none";
        document.getElementById("cartList").innerHTML = "";
        document.getElementById("cartList").style.display = "none";
        cart = [];
    }

    function deleteClass(classId) {
        if (!confirm("í•´ë‹¹ ê³¼ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            return;
        }

        const memberId = {{member.id}};  // ì„œë²„ì—ì„œ ë°›ì•„ì˜¤ëŠ” member ID

        fetch("/myClass/delete", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ memberId, classId })
        })
                .then(response => response.json())
                .then(data => {
                    alert(data.message);  // ì„œë²„ì—ì„œ ë°›ì€ ë©”ì‹œì§€ í‘œì‹œ
                    location.reload();    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("ì‚­ì œ ì‹¤íŒ¨! ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
                });
    }

    function confirmChange(code) {
        if (confirm("ğŸš¨[ì£¼ì˜]\ní˜„ì¬ í•™ê¸‰ ì •ë³´ë¥¼ ì´ˆê¸°í™” í›„ ì¬ì„¤ì • í•˜ì‹œê² ìŠµë‹ˆê¹Œ? \ní™•ì¸ ë²„íŠ¼ì„ ëˆ„ë¥¼ ì‹œ ìˆ˜ê°• ëª©ë¡ ë˜í•œ ì´ˆê¸°í™” ë©ë‹ˆë‹¤.")) {
            fetch('/teacher/studentDel', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({ studentId: code })
            })
                    .then(response => {
                        if (response.ok) {
                            alert("ì´ˆê¸°í™” ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ í•™ê¸‰ ì½”ë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!");
                            location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                        } else {
                            alert("ì´ˆê¸°í™”ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.");
                        }
                    })
                    .catch(error => {
                        console.error("ì˜¤ë¥˜ ë°œìƒ:", error);
                        alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    });
        }
    }
</script>
{{>footer}}